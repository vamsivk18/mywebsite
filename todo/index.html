<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div>
        <h1 style="text-align: center;">Create Todo List</h1>
        <div class="todo_div">
            <div class="title_div">
                <input class="title_input" type="text" name="" id="title_id" placeholder="title">
            </div>
            <div class="description_div">
                <input class="description_input" type="text" name="" id="description_id" placeholder="description">
            </div>
            <div class="add_div"><button class="add_button" onclick="create()">Add</button></div>
        </div>
    </div>
    <h1 style="text-align: center;">Todos</h1>
    <div id="container"></div>

    <!-- <div>
        <input id="title_id" type="text" placeholder="title"><br><br>
        <input id="description_id" type="text" placeholder="description"><br><br>
        <button onclick="create()">Add</button><br><br>
        <div id="container"></div>
    </div> -->
    <script>

        async function markasdone(id){
            let mark_elem = document.getElementById(`mark_button_${id}`)
            let completed = mark_elem.innerHTML==="Mark"?true:false
            console.log(completed)
            const request_options = {
                method:"POST",
                headers:{
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({"id":id,"completed":completed})
            }
            try{
                let response = await fetch("http://10.0.0.31:3000/update",request_options)
                let data = await response.json()
                // console.log(data)
                if(data.error){
                    alert(data.error)
                }
            }catch(err){
                console.log(err)
            }
            load_todos()
        }

        function createChild(todo){
            let completed = todo.completed?"Un Mark":"Mark"
            let todo_element = `
            <div class="todo_div_db" id="${todo.id}">
                <div class="title_div_db">
                    <p class="title_db">${todo.title}</p>
                </div>
                <div class="description_div_db">
                    <p class="description_db">${todo.description}</p>
                </div>
                <div class="add_div_db">
                    <button class="mark_button_db" id="mark_button_${todo.id}" onclick="markasdone('${todo.id}')">${completed}</button>
                    <button class="delete_button_db" onclick="deletetodo('${todo.id}')">Delete</button>
                </div>
            </div>`
            return todo_element
            // let topdiv = document.createElement("div")
            // topdiv.setAttribute("id",todo.id)
            // let child1 = document.createElement("div")
            // child1.innerHTML = todo.title
            // let child2 = document.createElement("div")
            // child2.innerHTML = todo.description
            // let child3 = document.createElement("button")
            // let completed = todo.completed?"Done":"Mark as Done"
            // child3.innerHTML = completed
            // child3.setAttribute("onclick",`markasdone(${todo.id})`)
            // topdiv.appendChild(child1)
            // topdiv.appendChild(child2)
            // topdiv.appendChild(child3)
            // return topdiv
        }

        async function load_todos(){
            let todo_response = await fetch("http://10.0.0.31:3000/todos")
            let todo_json = await todo_response.json()
            let todos = todo_json.todos
            console.log(todos)
            let container_element = document.getElementById("container")
            container_element.innerHTML = ""
            for(let i=0;i<todos.length;i++){
                container_element.innerHTML+=createChild(todos[i])
            }
        }
        async function create(){
            let title_elem = document.getElementById("title_id")
            let description_elem = document.getElementById("description_id")
            let title = title_elem.value
            let description = description_elem.value
            title_elem.value = ""
            description_elem.value = ""
            const todo_json = {"title":title,"description":description}
            const request_options = {
                method:"POST",
                headers:{
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(todo_json)
            }
            try{
                let response = await fetch("http://10.0.0.31:3000/create",request_options)
                let data = await response.json()
                console.log(data)
                if(data.error){
                    alert(data.error)
                }
            }catch(err){
                console.log(err)
            }
            load_todos()
        }
        async function deletetodo(id){
            const request_options = {
                method:"POST",
                headers:{
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({"id":id})
            }
            try{
                let response = await fetch("http://10.0.0.31:3000/delete",request_options)
                let data = await response.json()
                // console.log(data)
                if(data.error){
                    alert(data.error)
                }
            }catch(err){
                console.log(err)
            }
            load_todos()
        }
        load_todos()
    </script>
</body>
</html>
